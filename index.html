<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvestControl Pro - Gestão Integrada</title>
    
    <!-- Ícones Google Material -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    
    <!-- CSS Externo -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Biblioteca de Gráficos (Chart.js) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <!-- BARRA LATERAL -->
    <nav class="sidebar">
        <div class="brand">
            <span class="material-icons-outlined">insights</span>
            InvestControl
        </div>
        
        <div class="nav-links">
            <div class="menu-category">Geral</div>
            <a class="menu-item active" onclick="showPage('dashboard', this)">
                <span class="material-icons-outlined">dashboard</span> Resumo Geral
            </a>
            <a class="menu-item" onclick="showPage('despesas', this)">
                <span class="material-icons-outlined">receipt_long</span> Despesas & Análise
            </a>
            <a class="menu-item" onclick="showPage('evolucao', this)">
                <span class="material-icons-outlined">trending_up</span> Evolução
            </a>
            <a class="menu-item" onclick="showPage('comparativo', this)">
                <span class="material-icons-outlined">pie_chart</span> Comparativo (Meta)
            </a>

            <div class="menu-category">Operacional</div>
            <a class="menu-item" onclick="showPage('carteira_giro', this)">
                <span class="material-icons-outlined">sync_alt</span> Carteira Giro
            </a>
            <a class="menu-item" onclick="showPage('carteira_pessoal', this)">
                <span class="material-icons-outlined">account_balance_wallet</span> Carteira Pessoal
            </a>
            <a class="menu-item" onclick="showPage('aportes', this)">
                <span class="material-icons-outlined">add_circle</span> Novos Aportes
            </a>
            <a class="menu-item" onclick="showPage('planejamento', this)">
                <span class="material-icons-outlined">edit_calendar</span> Planejamento
            </a>
            <a class="menu-item" onclick="showPage('historico', this)">
                <span class="material-icons-outlined">history</span> Histórico
            </a>
        </div>

        <div style="border-top: 1px solid var(--border-color); padding-top: 10px;">
            <a class="menu-item" onclick="checkPasswordAndShowConfig(this)">
                <span class="material-icons-outlined">settings</span> Configurações
            </a>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="main-content">
        <!-- PÁGINA: DASHBOARD -->
        <section id="dashboard" class="page-section active-section">
            <div class="page-header">
                <div class="page-title">
                    <h2>Dashboard de Controle <span id="syncIndicator" class="status-indicator status-offline">Local</span></h2>
                    <p>Visão de receitas, gastos e patrimônio por período</p>
                </div>
            </div>
            
            <div class="dash-filters">
                <div class="form-group" style="margin:0"><label>Data Início</label><input type="date" id="dashGlobalStart" class="form-control" onchange="updateDashboard()"></div>
                <div class="form-group" style="margin:0"><label>Data Final</label><input type="date" id="dashGlobalEnd" class="form-control" onchange="updateDashboard()"></div>
                <button class="btn btn-blue" onclick="updateDashboard()" style="height: 45px;">Filtrar</button>
            </div>

            <div class="kpi-grid">
                <div class="card"><div class="kpi-label">Patrimônio Investido (Previsto)</div><div class="kpi-value" id="dashTotalInvestedPrev">R$ 0,00</div></div>
                <div class="card"><div class="kpi-label">Patrimônio Investido (Realizado)</div><div class="kpi-value" id="dashTotalInvested">R$ 0,00</div></div>

                <div class="card"><div class="kpi-label">Receitas (Previsto)</div><div class="kpi-value text-green" id="dashPeriodIncomePrev">R$ 0,00</div></div>
                <div class="card"><div class="kpi-label">Receitas (Realizado)</div><div class="kpi-value text-green" id="dashPeriodIncome">R$ 0,00</div></div>

                <div class="card"><div class="kpi-label">Despesas (Previsto)</div><div class="kpi-value text-red" id="dashPeriodExpensePrev">R$ 0,00</div></div>
                <div class="card"><div class="kpi-label">Despesas (Realizado)</div><div class="kpi-value text-red" id="dashPeriodExpense">R$ 0,00</div></div>

                <div class="card"><div class="kpi-label">Disponível p/ Giro (Previsto)</div><div class="kpi-value text-blue" id="dashBalanceReinvestPrev">R$ 0,00</div></div>
                <div class="card"><div class="kpi-label">Disponível p/ Giro (Realizado)</div><div class="kpi-value text-blue" id="dashBalanceReinvest">R$ 0,00</div></div>
            </div>

            <div class="form-grid">
                <div class="card"><h3>Distribuição de Ativos</h3><div style="height:250px"><canvas id="pieChart"></canvas></div></div>
                <div class="card"><h3>Fluxo Financeiro</h3><div style="height:250px"><canvas id="barChartDash"></canvas></div></div>
            </div>
        </section>

        <!-- PÁGINA: DESPESAS -->
        <section id="despesas" class="page-section">
            <div class="page-header"><h2>Acompanhamento de Despesas</h2></div>
            <div class="form-grid">
                <div class="card">
                    <h3>Árvore de Análise</h3>
                    <div id="expenseTree" style="margin-top: 20px;"></div>
                </div>
                <div class="card">
                    <h3>Gastos por Categoria</h3>
                    <div style="height:300px; margin-top: 20px;"><canvas id="expenseCompareChart"></canvas></div>
                </div>
            </div>
            <div class="card">
                <h3>Histórico de Saídas (Pessoal)</h3>
                <div class="table-container"><table><thead><tr><th>Data</th><th>Categoria</th><th>Descrição</th><th>Valor</th></tr></thead><tbody id="expenseTableBody"></tbody></table></div>
            </div>
        </section>

        <!-- PÁGINA: EVOLUÇÃO -->
        <section id="evolucao" class="page-section">
            <div class="page-header"><h2>Evolução Patrimonial</h2></div>
            <div class="card">
                <div class="filters-bar">
                    <div class="filter-item"><label>De</label><input type="date" id="filterStartDate" class="form-control" onchange="updateEvolutionChart()"></div>
                    <div class="filter-item"><label>Até</label><input type="date" id="filterEndDate" class="form-control" onchange="updateEvolutionChart()"></div>
                    <div class="filter-item">
                        <label>Tipo</label>
                        <select id="filterType" class="form-control" onchange="updateEvolutionChart()">
                            <option value="all">Todos</option>
                            <option>Renda Fixa</option>
                            <option>Ações</option>
                            <option>FIIs</option>
                            <option>Cripto</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="card"><div style="height:400px"><canvas id="evolutionChart"></canvas></div></div>
            <div class="card">
                <div class="table-container">
                    <table id="evolutionTable">
                        <thead><tr><th>Data</th><th>Patrimônio Projetado</th><th>Crescimento Bruto</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="pagination-controls">
                    <button onclick="changeEvoPage(-1)">◀</button>
                    <span id="pageIndicator">Página 1</span>
                    <button onclick="changeEvoPage(1)">▶</button>
                </div>
            </div>
        </section>

        <!-- PÁGINA: COMPARATIVO -->
        <section id="comparativo" class="page-section">
            <div class="page-header"><h2>Planejado vs Realizado</h2></div>
            <div class="kpi-grid">
                <div class="card"><div class="kpi-label">Meta Total</div><div class="kpi-value" id="compTotalPlanned">R$ 0,00</div></div>
                <div class="card"><div class="kpi-label">Realizado</div><div class="kpi-value text-green" id="compTotalRealized">R$ 0,00</div></div>
                <div class="card"><div class="kpi-label">Atingimento</div><div class="kpi-value text-blue" id="compPercentage">0%</div></div>
            </div>
            <div class="card">
                <h3>Comparativo Mensal</h3>
                <div style="height:350px"><canvas id="compBarChart"></canvas></div>
            </div>
        </section>

        <!-- CARTEIRA DE GIRO -->
        <section id="carteira_giro" class="page-section">
            <div class="page-header"><h2>Carteira de Giro</h2></div>
            <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                <div class="card" style="flex: 0 0 250px;">
                    <div class="kpi-label">Saldo Disponível</div>
                    <div class="kpi-value text-blue" id="balanceReinvest">R$ 0,00</div>
                </div>
                <div class="card" style="flex: 1;">
                    <h3>Nova Movimentação (Giro)</h3>
                    <form id="giroTransactionForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div class="form-group"><label>Nome</label><input type="text" id="gtxName" class="form-control" required></div>
                            <div class="form-group"><label>Categoria</label><select id="gtxCategory" class="form-control"></select></div>
                            <div class="form-group"><label>Data</label><input type="date" id="gtxDate" class="form-control" required></div>
                            <div class="form-group"><label>Valor (R$)</label><input type="number" id="gtxValue" class="form-control" step="0.01" required></div>
                            <div class="form-group"><label>Tipo</label><select id="gtxType" class="form-control" onchange="updateGiroAccountVisibility()"><option value="deposit">Depositar</option><option value="withdraw">Sacar</option></select></div>
                            <div class="form-group" id="giroAccountGroup" style="display:none;"><label>Conta</label><select id="gtxAccount" class="form-control"></select></div>
                            <div class="form-group" style="grid-column: 1/-1;"><label>Realizado?</label>
                            <div style="display:flex; gap:10px; align-items:center; margin-top:6px;">
                                <label><input type="radio" name="gtxRealized" value="yes" checked> Sim</label>
                                <label><input type="radio" name="gtxRealized" value="no"> Não</label>
                            </div>
                            </div>
                        </div>
                        <div style="display:flex; gap:8px; margin-top:10px;"><button class="btn btn-primary" type="submit" style="flex:1;">Salvar</button><button class="btn" type="reset" style="flex:1;">Limpar</button></div>
                    </form>
                </div>
            </div>
            <div class="form-grid">
                <div class="card">
                    <h3>Movimentações Previstas</h3>
                    <div class="table-container"><table><thead><tr><th>Data</th><th>Tipo</th><th>Descrição</th><th>Valor</th><th>Ação</th></tr></thead><tbody id="tableBodyReinvestPending"></tbody></table></div>
                </div>
                <div class="card">
                    <h3>Movimentações Realizadas</h3>
                    <div class="table-container"><table><thead><tr><th>Data</th><th>Tipo</th><th>Descrição</th><th>Valor</th><th>Ação</th></tr></thead><tbody id="tableBodyReinvestRealized"></tbody></table></div>
                </div>
            </div>
        </section>

        <!-- CARTEIRA PESSOAL -->
        <section id="carteira_pessoal" class="page-section">
            <div class="page-header"><h2>Carteira Pessoal</h2></div>
            <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                <div class="card" style="flex: 0 0 250px;">
                    <div class="kpi-label">Saldo Pessoal</div>
                    <div class="kpi-value text-yellow" id="balancePersonal">R$ 0,00</div>
                </div>
                <div class="card" style="flex: 1;">
                    <h3>Nova Transação (Pessoal)</h3>
                    <form id="personalTransactionForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <div class="form-group"><label>Nome</label><input type="text" id="ptxName" class="form-control" required></div>
                            <div class="form-group"><label>Categoria</label><select id="ptxCategory" class="form-control"></select></div>
                            <div class="form-group"><label>Subcategoria</label><select id="ptxSubcategory" class="form-control"></select></div>
                            <div class="form-group"><label>Conta</label><select id="ptxAccount" class="form-control"></select></div>
                            <div class="form-group"><label>Data</label><input type="date" id="ptxDate" class="form-control" required></div>
                            <div class="form-group"><label>Valor (R$)</label><input type="number" id="ptxValue" class="form-control" step="0.01" required></div>
                            <div class="form-group"><label>Tipo</label><select id="ptxType" class="form-control" onchange="updatePersonalGiroVisibility()"><option value="deposit">Receita</option><option value="withdraw">Despesa</option></select></div>
                            <div class="form-group" id="personalGiroGroup" style="display:none;"><label>P/ Giro?</label><select id="ptxToGiro" class="form-control"><option value="no">Não</option><option value="yes">Sim</option></select></div>
                            <div class="form-group" style="grid-column: 1/-1;"><label>Realizado?</label>
                            <div style="display:flex; gap:10px; align-items:center; margin-top:6px;">
                                <label><input type="radio" name="ptxRealized" value="yes" checked> Sim</label>
                                <label><input type="radio" name="ptxRealized" value="no"> Não</label>
                            </div>
                            </div>
                        </div>
                        <div style="display:flex; gap:8px; margin-top:10px;"><button class="btn btn-primary" type="submit" style="flex:1;">Salvar</button><button class="btn" type="reset" style="flex:1;">Limpar</button></div>
                    </form>
                </div>
            </div>
            <div class="form-grid">
                <div class="card">
                    <h3>Transações Previstas</h3>
                    <div class="table-container"><table><thead><tr><th>Data</th><th>Tipo</th><th>Descrição</th><th>Valor</th><th>Ação</th></tr></thead><tbody id="tableBodyPersonalPending"></tbody></table></div>
                </div>
                <div class="card">
                    <h3>Transações Realizadas</h3>
                    <div class="table-container"><table><thead><tr><th>Data</th><th>Tipo</th><th>Descrição</th><th>Valor</th><th>Ação</th></tr></thead><tbody id="tableBodyPersonalRealized"></tbody></table></div>
                </div>
            </div>
        </section>

        <!-- APORTES -->
        <section id="aportes" class="page-section">
            <div class="page-header"><h2>Novo Aporte</h2></div>
            <div class="card">
                <form id="investForm">
                    <div class="form-grid">
                        <div>
                            <div class="form-group"><label>Nome do Ativo</label><input type="text" id="inpName" class="form-control" required></div>
                            <div class="form-group"><label>Instituição</label>
                                <select id="inpInst" class="form-control"><option>XP Investimentos</option><option>BTG Pactual</option><option>NuInvest</option><option>Banco Inter</option><option>Outra</option></select>
                            </div>
                            <div class="form-group"><label>Tipo</label>
                                <select id="inpType" class="form-control"><option>Renda Fixa</option><option>Ações</option><option>FIIs</option><option>Cripto</option></select>
                            </div>
                            <div class="form-group"><label>Valor (R$)</label><input type="number" id="inpValue" class="form-control" step="0.01" required></div>
                        </div>
                        <div>
                            <div class="form-group"><label>Data Aporte</label><input type="date" id="inpDate" class="form-control" required></div>
                            <div class="form-group"><label>Vencimento</label><input type="date" id="inpExpiry" class="form-control"></div>
                            <div class="form-group">
                                <label>Taxa Prevista</label>
                                <div style="display:flex; gap:5px;">
                                    <input type="number" id="inpRatePrev" class="form-control" step="0.01">
                                    <select id="inpRateTypePrev" class="form-control"><option>% CDI</option><option>% a.a.</option><option>IPCA +</option></select>
                                </div>
                            </div>
                            <div class="form-group"><label>Status</label><select id="inpStatus" class="form-control"><option>Ativo</option><option>Finalizado</option></select></div>
                        </div>
                    </div>
                    <div class="form-group"><label>Realizado?</label>
                        <div style="display:flex; gap:10px; align-items:center; margin-top:6px;">
                            <label><input type="radio" name="inpRealized" value="yes" checked> Sim</label>
                            <label><input type="radio" name="inpRealized" value="no"> Não</label>
                        </div>
                    </div>
                    <button class="btn btn-primary" type="submit" style="width:100%">Salvar Aporte</button>
                </form>
            </div>
        </section>

        <!-- PLANEJAMENTO -->
        <section id="planejamento" class="page-section">
            <div class="page-header"><h2>Planejamento</h2></div>
            <div class="card">
                <form id="planForm">
                    <div class="form-grid">
                        <div class="form-group"><label>Mês Referência</label><input type="month" id="inpPlanMonth" class="form-control" required></div>
                        <div class="form-group"><label>Meta de Aporte (R$)</label><input type="number" id="inpPlanValue" class="form-control" step="0.01" required></div>
                        <div class="form-group"><label>Categoria</label><select id="inpPlanCategory" class="form-control"><option value="Geral">Geral</option><option>Investimentos</option></select></div>
                    </div>
                    <button class="btn btn-primary" type="submit">Definir Meta</button>
                </form>
            </div>
            <div class="card">
                <div class="table-container"><table><thead><tr><th>Mês/Ano</th><th>Categoria</th><th>Valor Meta</th><th>Ação</th></tr></thead><tbody id="plansTableBody"></tbody></table></div>
            </div>
        </section>

        <!-- HISTÓRICO -->
        <section id="historico" class="page-section">
            <div class="page-header"><h2>Histórico</h2><button class="btn btn-danger" onclick="clearAllData()">Reset Local</button></div>
            <div class="card"><div class="table-container"><table><thead><tr><th>Ativo</th><th>Data</th><th>Vencimento</th><th>Valor</th><th>Ação</th></tr></thead><tbody id="investTableBody"></tbody></table></div></div>
        </section>

        <!-- CONFIGURAÇÕES -->
        <section id="config" class="page-section">
            <div class="page-header"><h2>Configurações & Memória de Cálculo</h2></div>
            <div class="card">
                <h3>Como os cálculos são feitos</h3>
                <div class="calc-memo">
                    <p><strong>Evolução Patrimonial:</strong> M = P * (1 + i)^n. O sistema calcula a rentabilidade mensal projetada com base nas taxas CDI (11.25% ref) e IPCA (4.5% ref) configuradas.</p>
                    <p><strong>Sincronização:</strong> Toda retirada da Carteira Pessoal com a palavra "Investimento" gera um aporte automático na Carteira Giro.</p>
                </div>
            </div>
            <div class="form-grid">
                <div class="card">
                    <h3>Mercado</h3>
                    <div class="form-group"><label>Taxa CDI Padrão (%)</label><input type="number" id="cfgCdi" class="form-control" value="11.25"></div>
                    <div class="form-group"><label>Inflação IPCA Padrão (%)</label><input type="number" id="cfgIpca" class="form-control" value="4.5"></div>
                </div>
                <div class="card">
                    <h3>Sincronização</h3>
                    <button class="btn btn-blue" onclick="loadFromSheet()" style="width:100%">Sincronizar Planilha Agora</button>
                    <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 15px;">URL: Google Sheets Ativo</p>
                </div>
                <div class="card">
                    <h3>Giro - Categorias</h3>
                    <div class="form-group"><label>Nova Categoria</label><input id="inpGiroCategory" class="form-control" placeholder="Nome da categoria"><button class="btn btn-primary" style="margin-top:8px;" onclick="addConfig('giroCategories','inpGiroCategory')">Adicionar</button></div>
                    <div class="table-container"><table><thead><tr><th>Categoria</th><th style="width:80px">Ação</th></tr></thead><tbody id="configGiroCategoryTable"></tbody></table></div>
                </div>
                <div class="card">
                    <h3>Giro - Contas</h3>
                    <div class="form-group"><label>Nova Conta</label><input id="inpGiroAccount" class="form-control" placeholder="Nome da conta"><button class="btn btn-primary" style="margin-top:8px;" onclick="addConfig('giroAccounts','inpGiroAccount')">Adicionar</button></div>
                    <div class="table-container"><table><thead><tr><th>Conta</th><th style="width:80px">Ação</th></tr></thead><tbody id="configGiroAccountTable"></tbody></table></div>
                </div>
                <div class="card">
                    <h3>Pessoal - Categorias</h3>
                    <div class="form-group"><label>Nova Categoria</label><input id="inpPersonalCategory" class="form-control" placeholder="Nome da categoria"><button class="btn btn-primary" style="margin-top:8px;" onclick="addConfig('personalCategories','inpPersonalCategory')">Adicionar</button></div>
                    <div class="table-container"><table><thead><tr><th>Categoria</th><th style="width:80px">Ação</th></tr></thead><tbody id="configPersonalCategoryTable"></tbody></table></div>
                </div>
                <div class="card">
                    <h3>Pessoal - Subcategorias</h3>
                    <div class="form-group"><label>Nova Subcategoria</label><input id="inpPersonalSubcategory" class="form-control" placeholder="Nome da subcategoria"><button class="btn btn-primary" style="margin-top:8px;" onclick="addConfig('personalSubcategories','inpPersonalSubcategory')">Adicionar</button></div>
                    <div class="table-container"><table><thead><tr><th>Subcategoria</th><th style="width:80px">Ação</th></tr></thead><tbody id="configPersonalSubcategoryTable"></tbody></table></div>
                </div>
                <div class="card">
                    <h3>Pessoal - Contas</h3>
                    <div class="form-group"><label>Nova Conta</label><input id="inpPersonalAccount" class="form-control" placeholder="Nome da conta"><button class="btn btn-primary" style="margin-top:8px;" onclick="addConfig('personalAccounts','inpPersonalAccount')">Adicionar</button></div>
                    <div class="table-container"><table><thead><tr><th>Conta</th><th style="width:80px">Ação</th></tr></thead><tbody id="configPersonalAccountTable"></tbody></table></div>
                </div>
            </div>
        </section>
    </main>

    <script src="script.js"></script>
</body>
</html>
